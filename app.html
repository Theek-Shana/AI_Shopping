<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapShop AI - Product Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.3), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 text-white min-h-screen">
    
    <!-- Header -->
    <div class="border-b border-purple-700/50 bg-purple-950/30 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-pink-500 to-purple-600 p-2 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold">SNAPSHOP AI</h1>
            </div>
            <div class="flex items-center gap-2 text-sm text-purple-300">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                </svg>
                AI Powered (Demo Mode)
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Info Banner -->
        <div class="mb-6 bg-blue-500/20 border border-blue-500/50 rounded-lg p-4 flex items-start gap-3">
            <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="flex-1">
                <div class="font-semibold mb-1">Demo Mode</div>
                <div class="text-sm text-blue-300">This version uses simulated AI analysis. For real product identification with web search, use the version inside Claude.ai or set up a backend server with an API key.</div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorAlert" class="hidden mb-6 bg-red-500/20 border border-red-500/50 rounded-lg p-4 flex items-start gap-3">
            <svg class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="flex-1">
                <div id="errorText" class="text-red-300"></div>
                <button onclick="dismissError()" class="mt-2 text-sm text-red-400 hover:text-red-300 underline">
                    Dismiss
                </button>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-6">
            <!-- Upload Section -->
            <div class="bg-purple-950/50 backdrop-blur-sm rounded-2xl border border-purple-700/30 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold">Upload Image</h2>
                    <label class="cursor-pointer bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                        Upload New
                        <input type="file" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                    </label>
                </div>

                <div id="uploadArea">
                    <label class="border-2 border-dashed border-purple-600/50 rounded-lg p-12 flex flex-col items-center justify-center cursor-pointer hover:border-purple-500 transition-colors">
                        <svg class="w-16 h-16 text-purple-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <p class="text-lg font-medium mb-2">Upload Product Image</p>
                        <p class="text-sm text-purple-300">Click to select an image</p>
                        <input type="file" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                    </label>
                </div>

                <div id="imagePreview" class="hidden space-y-4">
                    <div class="bg-white rounded-lg overflow-hidden relative">
                        <img id="previewImg" src="" alt="Product to analyze" class="w-full h-auto">
                        <button onclick="resetUpload()" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 p-2 rounded-full transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    <button onclick="analyzeImage()" id="analyzeBtn" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                        </svg>
                        Analyze Product
                    </button>
                </div>
            </div>

            <!-- Analysis Section -->
            <div class="bg-purple-950/50 backdrop-blur-sm rounded-2xl border border-purple-700/30 p-6">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                    <h2 class="text-xl font-semibold">AI Analysis</h2>
                </div>

                <div id="emptyState" class="text-center py-12 text-purple-300">
                    <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                    </svg>
                    <p>Upload an image and click Analyze to get started</p>
                </div>

                <div id="analysisResult" class="hidden space-y-6 max-h-[600px] overflow-y-auto pr-2"></div>
            </div>
        </div>
    </div>
<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.6.0/dist/tf.min.js"></script>
<!-- MobileNet -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.2.1/dist/mobilenet.min.js"></script>

    <script>
        let currentImage = null;

        function handleImageUpload(event) {
            const file = event.target.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onloadend = () => {
                currentImage = reader.result;
                document.getElementById('previewImg').src = currentImage;
                document.getElementById('uploadArea').classList.add('hidden');
                document.getElementById('imagePreview').classList.remove('hidden');
                document.getElementById('analysisResult').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
                dismissError();
            };
            reader.onerror = () => {
                showError("Failed to read the image file");
            };
            reader.readAsDataURL(file);
        }

        function resetUpload() {
            currentImage = null;
            document.getElementById('uploadArea').classList.remove('hidden');
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('analysisResult').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('hidden');
            dismissError();
        }

        let mobilenetModel = null;

// lazy load model
async function ensureModel() {
  if (mobilenetModel) return;
  try {
    // load MobileNet
    mobilenetModel = await mobilenet.load({ version: 2, alpha: 1.0 });
  } catch (e) {
    console.error("Model load error", e);
    showError("Failed to load TF model. Check network.");
  }
}

async function analyzeImage() {
  if (!currentImage) {
    showError("Please upload an image first");
    return;
  }

  const analyzeBtn = document.getElementById('analyzeBtn');
  analyzeBtn.disabled = true;
  analyzeBtn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>Identifying...`;

  try {
    await ensureModel();
    if (!mobilenetModel) throw new Error("Model not available");

    // create image element from data URL
    const img = new Image();
    img.src = currentImage;
    await new Promise((res, rej) => {
      img.onload = res;
      img.onerror = rej;
    });

    // classify
    const predictions = await mobilenetModel.classify(img, 5); // top 5

    // build a friendly analysis object (similar shape to your demo)
    const labels = predictions.map(p => `${p.className} (${(p.probability*100).toFixed(1)}%)`);
    const topLabel = predictions[0]?.className || "Unknown";
    const conf = predictions[0]?.probability ? (predictions[0].probability*100).toFixed(1) : null;

    const analysis = {
      productName: topLabel.replace(/,.*$/,''),
      category: topLabel.split(',')[0],
      brand: null,
      description: `Detected labels: ${labels.join(', ')}. Confidence for top label: ${conf ? conf + '%' : 'n/a'}. This is an automated classification using MobileNet (client-side).`,
      features: [ `Top labels: ${labels.join('; ')}` ],
      estimatedPrice: "Search online (free) â€” see links",
      buyingTips: [
        "Use the search links below to compare prices and reviews",
        "Check shipping & return policy on each site",
        "If label is generic (e.g., 'headphones'), add brand name in search"
      ],
      similarProducts: [],
      whereToBuy: [
        { store: "Google Search", price: "", reason: "Search results for product keywords" },
        { store: "Bing Visual Search", price: "", reason: "Visual search & shopping results" },
        { store: "TinEye (reverse image)", price: "", reason: "Find matches of the exact image across web" }
      ],
      bestFor: []
    };

    // Display analysis (your displayAnalysis expects certain fields)
    displayAnalysis(analysis);

    // Add quick-search buttons to the analysis result area
    addQuickSearches(predictions);

  } catch (err) {
    console.error(err);
    showError("Failed to identify image: " + err.message);
  } finally {
    analyzeBtn.disabled = false;
    analyzeBtn.innerHTML = `
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
      </svg>
      Analyze Product
    `;
  }
}

// create quick search links and show them under analysisResult
function addQuickSearches(predictions) {
  const resultDiv = document.getElementById('analysisResult');
  const q = encodeURIComponent(predictions.map(p => p.className.split(',')[0]).join(' '));
  const dataUrl = currentImage; // base64 string

  // for reverse image search we will open the data in a new tab for the user to drag/drop
  const html = `
    <div class="mt-4">
      <h4 class="font-semibold text-purple-100 mb-2">Free quick actions</h4>
      <div class="flex flex-wrap gap-2">
        <button onclick="window.open('https://www.google.com/search?q=${q}+buy','_blank')" class="px-3 py-1 rounded bg-purple-700/40">Search Google</button>
        <button onclick="window.open('https://www.bing.com/images/search?q=${q}&qft=+filterui:imagesize-large','_blank')" class="px-3 py-1 rounded bg-purple-700/40">Search Bing</button>
        <button onclick="openTinEye()" class="px-3 py-1 rounded bg-purple-700/40">Open TinEye (reverse)</button>
        <button onclick="openGoogleLens()" class="px-3 py-1 rounded bg-purple-700/40">Open Google Lens</button>
      </div>
      <div class="text-sm text-purple-300 mt-2">Tip: If reverse image sites ask for a URL, click "Open Image in new tab", copy that URL and paste into the reverse search.</div>
    </div>
  `;
  // append to the end of existing result HTML
  resultDiv.insertAdjacentHTML('beforeend', html);
}

// Helper: open TinEye with instructions (can't auto-upload base64)
function openTinEye() {
  window.open('https://tineye.com/', '_blank');
}
function openGoogleLens() {
  // Google Lens web interface: opens images.google.com where user can drag image
  window.open('https://images.google.com/', '_blank');
}


        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorAlert').classList.remove('hidden');
        }

        function dismissError() {
            document.getElementById('errorAlert').classList.add('hidden');
        }

        
    </script>
</body>
</html>